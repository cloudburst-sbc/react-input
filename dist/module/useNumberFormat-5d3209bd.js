import{useEffect as e,useRef as i,useCallback as t}from"react";import{SyntheticChangeError as n,useInput as a}from"@react-input/core";var r=function(){return r=Object.assign||function(e){for(var i,t=1,n=arguments.length;t<n;t++)for(var a in i=arguments[t])Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a]);return e},r.apply(this,arguments)};function c(e,i){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(t[n[a]]=e[n[a]])}return t}function s(e,i){void 0===i&&(i={});var t=i.format,n=i.groupDisplay,a=i.maximumIntegerDigits,s=void 0===a?21:a,o=c(i,["format","groupDisplay","maximumIntegerDigits"]),l=Intl.NumberFormat(e,r(r({},o),{style:t,useGrouping:n})).resolvedOptions();l.format=l.style,l.groupDisplay=l.useGrouping,l.maximumIntegerDigits=s,l.maximumIntegerDigits<l.minimumIntegerDigits&&(l.maximumIntegerDigits=l.minimumIntegerDigits);var u=l;return delete u.style,delete u.currencySign,delete u.useGrouping,delete u.minimumSignificantDigits,delete u.maximumSignificantDigits,delete u.compactDisplay,delete u.notation,delete u.numberingSystem,delete u.localeMatcher,delete u.roundingIncrement,delete u.roundingMode,delete u.roundingPriority,delete u.trailingZeroDisplay,{current:i,resolved:l}}function o(e){var i=Intl.NumberFormat(e,{useGrouping:!1,signDisplay:"always",minimumIntegerDigits:10,minimumFractionDigits:1,maximumFractionDigits:1}).format(-1234567890.1),t="‎"===i[0]||"؜"===i[0],n=t?i[1]:i[0],a=i[i.length-2],r=i.slice(t?2:1,-2);return{signBackwards:t,minusSign:n,decimal:a,digits:r=r[9]+r.slice(0,-1)}}function l(e){var i=e.resolvedOptions.minimumFractionDigits,t=void 0===i?0:i;return t<0?0:t}function u(u){var g=null!=u?u:{},m=g.locales,d=g.format,p=g.currency,v=g.currencyDisplay,f=g.unit,x=g.unitDisplay,D=g.signDisplay,y=g.groupDisplay,h=g.minimumIntegerDigits,E=g.maximumIntegerDigits,I=g.minimumFractionDigits,O=g.maximumFractionDigits,R=g.onNumberFormat,S={format:d,currency:p,currencyDisplay:v,unit:f,unitDisplay:x,signDisplay:D,groupDisplay:y,minimumIntegerDigits:h,maximumIntegerDigits:E,minimumFractionDigits:I,maximumFractionDigits:O},b=i(null),w=JSON.stringify(m),F=JSON.stringify(S),V=t((function(e){var i=e.initialValue,t={locales:m,options:S};return b.current={value:i,props:t,fallbackProps:t},{value:i}}),[]),k=t((function(e){var i=e.inputType,t=e.addedValue,a=e.previousValue,u=e.changeStart,g=e.changeEnd;if(null===b.current)throw new n("The state has not been initialized.");b.current.value!==a?b.current.props=b.current.fallbackProps:b.current.fallbackProps=b.current.props;var d=o(b.current.props.locales),p=o(m),v=s(m,S),f=v.current,x=v.resolved,D=function(e){var i="\\-\\".concat(p.minusSign),t=".,".concat(p.decimal),n="\\d".concat(p.digits),a="[^".concat(i).concat(t).concat(n,"]|[").concat(t,"](?=.*[").concat(t,"])"),r=e.replace(RegExp(a,"g"),"");if(p.signBackwards)return r.replace(RegExp("[".concat(i,"](?=.*[").concat(i).concat(t).concat(n,"])"),"g"),"");var c=r.search(RegExp("[".concat(i,"]"))),s=r.search(RegExp("[".concat(t,"]"))),o=r.search(RegExp("[".concat(n,"]")));return r.replace(RegExp("[".concat(i,"]"),"g"),(function(e,i){return-1!==c&&i>c||-1!==s&&i>s||-1!==o&&i>o?"":e}))};if(t=D(t),"insert"===i&&!t)throw new n("The added value does not contain allowed characters.");var y=RegExp("[^\\".concat(d.minusSign).concat(d.decimal).concat(d.digits,"]"),"g"),h=a.slice(0,u).replace(y,"")+t+a.slice(g).replace(y,"");h=D(h).replace(RegExp("[,".concat(p.decimal,"]"),"g"),".").replace(RegExp(p.minusSign,"g"),"-").replace(RegExp("[".concat(p.digits,"]"),"g"),(function(e){var i=p.digits.indexOf(e);return-1!==i?i.toString():e}));var E=RegExp("^[\\-\\".concat(p.minusSign,"]$")).test(t)&&u===g,I=a.includes(d.minusSign),O=h.includes("-");if(E&&I&&O&&(h=h.replace("-","")),!E||I||O||(h="-".concat(h)),"-"===h[h.length-1]&&(h="-".concat(h.slice(0,-1))),/\..*0$/.test(h)){for(var R="",w=-1,F=0,V=!1;F<a.length;F++){var k=d.digits.includes(a[F]),N=a[F]===d.decimal;V?k&&(R+=a[F],-1===w&&(w=F)):N&&(V=!0)}if(-1!==w){var P=l({resolvedOptions:s(b.current.props.locales,b.current.props.options).resolved});u>=w&&g<w+(P||1)&&R.length<=(P||1)&&(h=h.replace(/0+$/g,""))}}var T=function(e,i){var t=i.inputType,n=i.locales,a=i.localizedValues,s=i.currentOptions,o=i.resolvedOptions;if(("deleteBackward"===t||"deleteForward"===t)&&(""===e||"-"===e||/^-?\.?0*$/.test(e)))return{value:"",number:0};var u="-"===e[0],g=(u?e.slice(1):e).split("."),m=g[0],d=g[1],p=void 0===d?void 0:d,v=o.minimumFractionDigits,f=o.maximumFractionDigits;m=m.replace(/^0+/g,"").slice(0,o.maximumIntegerDigits),p=null==p?void 0:p.slice(0,f);var x=Number((u?"-":"")+(m||"0")+(p?".".concat(p):""));v=l({resolvedOptions:o}),"insert"===t&&""===p&&0===v&&f>0&&(v=1),void 0!==p&&p.length>v&&(v=p.length);var D=null!=s?s:{},y=D.format,h=D.groupDisplay;D.maximumIntegerDigits;var E=c(D,["format","groupDisplay","maximumIntegerDigits"]),I=Intl.NumberFormat(n,r(r({},E),{style:y,useGrouping:h,minimumFractionDigits:v})).format(x),O=(I=I.replace(/\s/g," ")).includes("+")?"+":I.includes(a.minusSign)?a.minusSign:void 0;if(void 0!==O&&a.signBackwards){var R=(I=I.replace(RegExp("[‎؜\\".concat(O,"]"),"g"),"")).search(RegExp("[".concat(a.digits,"](?!.*[").concat(a.digits,"])")));-1!==R&&"‏"!==(I=I.slice(0,R+1)+O+I.slice(R+1))[0]&&(I="‏".concat(I))}return{value:I,number:x}}(h,{inputType:i,locales:m,localizedValues:p,currentOptions:f,resolvedOptions:x}),$=function(e){var i,t,n,a=e.localizedValues,r=e.previousLocalizedValues,c=e.resolvedOptions,s=e.inputType,o=e.addedValue,l=e.previousValue,u=e.nextValue,g=e.changeStart,m=e.changeEnd;if(RegExp("^[.,".concat(a.decimal,"]$")).test(o)&&l.includes(a.decimal)){var d=u.indexOf(a.decimal);if(-1!==d)return{start:p=d+1,end:p}}if(RegExp("^[\\-\\".concat(a.minusSign,"]$")).test(o)&&l.includes(a.minusSign)){var p,v=u.indexOf(a.minusSign);if(-1!==v)return{start:p=v+(a.signBackwards?0:1),end:p}}if("deleteBackward"===s||"deleteForward"===s){var f=l.split(r.decimal)[0];if(m<=f.length&&!RegExp("[".concat(r.digits.slice(1),"]")).test(f)){var x=f.indexOf(r.digits[0]),D=f.lastIndexOf(r.digits[0]);if(-1!==x&&-1!==D&&(g!==x||m!==D+1)&&m>x&&m<=D+1)return{start:x,end:D+1}}}for(var y=u.length,h=0,E=0,I=!1;E<g;E++){var O=r.digits.includes(l[E]);if(!I){var R=l[E]===r.decimal,S=O&&l[E]!==r.digits[0];(R||S)&&(I=!0)}I&&O&&(h+=1)}if("insert"===s){var b=l.slice(0,g),w=b.replace(RegExp("[^".concat(r.decimal).concat(r.digits,"]"),"g"),"").replace(RegExp("^".concat(r.digits[0],"+"),"g"),"").split(r.decimal),F=w[0],V=w[1],k=void 0===V?"":V,N=RegExp("[^\\d".concat(a.digits,"]+"),"g"),P=l.indexOf(r.decimal),T=o.replace(RegExp("[\\-\\".concat(a.minusSign,"]"),"g"),"").replace(RegExp("[,".concat(a.decimal,"]"),"g"),".");-1!==P&&m<=P&&(T=T.replace(N,""));var $=T.split("."),z=$[0],B=$[1],j=void 0===B?"":B;if(-1!==P&&g>P)if(T.includes(".")){var G=F+k;G.length>c.maximumIntegerDigits&&(h=c.maximumIntegerDigits,F=G.slice(0,c.maximumIntegerDigits))}else j=z,z="";var _="[".concat(r.decimal).concat(r.digits.slice(1),"]");if(!RegExp(_).test(b)){var J="^[0".concat(r.digits[0],"]+");z=z.replace(RegExp(J,"g"),"")}h+=(z.slice(0,c.maximumIntegerDigits-F.length)+j).replace(N,"").length}E=0,I=!1;for(var L=0;E<u.length;E++){if(I||a.decimal!==u[E]&&!a.digits.slice(1).includes(u[E])||(I=!0),I&&L>=h){y=E;break}I&&a.digits.includes(u[E])&&(L+=1)}if("deleteForward"===s){_="^.{".concat(y,"}[^").concat(a.digits,"]*[\\").concat(a.minusSign).concat(a.digits,"]");var M=null===(i=u.match(RegExp(_)))||void 0===i?void 0:i[0].length;void 0!==M&&(y=M-1)}else{_="[".concat("deleteBackward"===s?"\\".concat(a.minusSign):"").concat(a.digits,"][^").concat(a.digits,"]*.{").concat(u.length-y,"}$");var H=null===(t=u.match(RegExp(_)))||void 0===t?void 0:t.index;void 0!==H&&(y=H+1),u[y]===a.decimal&&RegExp("[.,".concat(a.decimal,"]")).test(null!==(n=o[o.length-1])&&void 0!==n?n:"")&&(y+=1)}_="[\\".concat(a.minusSign).concat(a.decimal).concat(a.digits.slice(1),"]"),J="[\\".concat(a.minusSign).concat(a.digits,"][^").concat(a.digits,"]*$");var Z=u.search(RegExp(_)),q=u.search(RegExp(J));return-1!==Z&&y<Z?y=Z:-1!==q&&y>q+1&&(y=q+1),{start:y,end:y}}({localizedValues:p,previousLocalizedValues:d,resolvedOptions:x,inputType:i,addedValue:t,previousValue:a,nextValue:T.value,changeStart:u,changeEnd:g});return b.current.value=T.value,b.current.props={locales:m,options:S},{value:T.value,selectionStart:$.start,selectionEnd:$.end,__detail:T}}),[w,F]),N=a({init:V,tracking:k,customInputEventType:"input-number-format",customInputEventHandler:R});return function(i){var t=i.locales,n=i.options;e((function(){if("production"!==process.env.NODE_ENV){var e=s(t,n),i=e.current,a=e.resolved,r="number"!=typeof i.maximumIntegerDigits&&void 0!==i.maximumIntegerDigits,c="number"==typeof i.maximumIntegerDigits&&i.maximumIntegerDigits<a.minimumIntegerDigits;if(r||c)throw new RangeError("maximumIntegerDigits value is out of range.")}}),[])}({locales:m,options:S}),N}export{c as _,r as a,u};
