import{useEffect as e,useRef as r,useCallback as t}from"react";import{SyntheticChangeError as n,useInput as a}from"@react-input/core";var l=function(e,r){var t="".concat(e,"\n\n").concat(r,"\n");return new Error(t)};function o(e){for(var r,t=e.value,n=e.replacementChars,a=e.replacement,l=e.separate,o=n,p="",c=0;c<t.length;c++){var i=!Object.prototype.hasOwnProperty.call(a,t[c])&&(null===(r=a[o[0]])||void 0===r?void 0:r.test(t[c]));(l&&t[c]===o[0]||i)&&(o=o.slice(1),p+=t[c])}return p}function p(e,r,t){for(var n=["[","]","\\","/","^","$",".","|","?","*","+","(",")","{","}"],a="",l=0;l<e.length;l++){var o=Object.prototype.hasOwnProperty.call(r,e[l]),p=t?"(?!".concat(e[l],")"):"";0===l&&(a+="^"),a+=o?p+r[e[l]].toString().slice(1,-1):n.includes(e[l])?"\\".concat(e[l]):e[l],l===e.length-1&&(a+="$")}return a}function c(e,r){var t=r.mask,n=r.replacement,a=r.showMask,l=function(e,r){for(var t=r.mask,n=r.replacement,a=0,l="",o=0;o<t.length;o++)Object.prototype.hasOwnProperty.call(n,t[o])&&void 0!==e[a]?l+=e[a++]:l+=t[o];return l}(e,{mask:t,replacement:n}),o=function(e,r){var t=r.mask,n=r.replacement;return e.split("").map((function(e,r){return{type:Object.prototype.hasOwnProperty.call(n,e)?"replacement":e===t[r]?"mask":"input",value:e,index:r}}))}(l,{mask:t,replacement:n});if(!a){for(var c=-1,i=o.length-1;i>=0;i--)if("input"===o[i].type){c=o[i].index;break}l=l.slice(0,c+1)}var s=p(t,n,!1),u=p(t,n,!0);return{value:l,input:e,parts:o,pattern:s,isValid:RegExp(u).test(l)}}function i(e){for(var r=e.value,t=e.start,n=void 0===t?0:t,a=e.end,l=e.mask,o=e.replacement,p=e.separate,c=l.slice(n,a),i=r.slice(n,a),s="",u=0;u<c.length;u++){var v=Object.prototype.hasOwnProperty.call(o,c[u]);v&&void 0!==i[u]&&i[u]!==c[u]?s+=i[u]:v&&p&&(s+=c[u])}return s}var s=function(e){var r;return e.length>0?((r={})[e]=/./,r):{}};function u(p){var u=null!=p?p:{},v=u.mask,d=void 0===v?"":v,h=u.replacement,f=void 0===h?{}:h,m=u.showMask,k=void 0!==m&&m,g=u.separate,y=void 0!==g&&g,w=u.modify,b=u.onMask,O="string"==typeof f?s(f):f,j=r(null),x=JSON.stringify(O,(function(e,r){return r instanceof RegExp?r.toString():r})),V=t((function(e){var r=e.controlled,t=e.initialValue;t=r||t?t:k?d:"";var n={mask:d,replacement:O,showMask:k,separate:y};return j.current={value:t,props:n,fallbackProps:n},{value:t}}),[]),E=t((function(e){var r,t=e.inputType,a=e.addedValue,l=e.previousValue,p=e.changeStart,u=e.changeEnd;if(null===j.current)throw new n("The state has not been initialized.");j.current.value!==l?j.current.props=j.current.fallbackProps:j.current.fallbackProps=j.current.props;var v=i({value:l,end:p,mask:j.current.props.mask,replacement:j.current.props.replacement,separate:j.current.props.separate}),h=RegExp("[^".concat(Object.keys(j.current.props.replacement),"]"),"g"),f=j.current.props.mask.replace(h,"");if(v&&(v=o({value:v,replacementChars:f,replacement:j.current.props.replacement,separate:j.current.props.separate})),a&&(a=o({value:a,replacementChars:f.slice(v.length),replacement:j.current.props.replacement,separate:!1})),"insert"===t&&""===a)throw new n("The character does not match the key value of the `replacement` object.");var m=i({value:l,start:u,mask:j.current.props.mask,replacement:j.current.props.replacement,separate:j.current.props.separate});if(j.current.props.separate){var g=j.current.props.mask.slice(p,u).replace(h,""),b=g.length-a.length;b<0?m=m.slice(-b):b>0&&(m=g.slice(-b)+m)}m&&(m=o({value:m,replacementChars:f.slice(v.length+a.length),replacement:j.current.props.replacement,separate:j.current.props.separate}));var x=v+a+m,V=null!==(r=null==w?void 0:w(x))&&void 0!==r?r:{},E=V.mask,P=void 0===E?d:E,C=V.replacement,I=void 0===C?O:C,M=V.showMask,T=void 0===M?k:M,R=V.separate,S=void 0===R?y:R;"string"==typeof I&&(I=s(I));var z=c(x,{mask:P,replacement:I,showMask:T}),_=function(e){var r,t,n,a=e.inputType,l=e.value,o=e.addedValue,p=e.beforeChangeValue,c=e.parts,i=e.replacement,s=e.separate,u=c.filter((function(e){var r=e.type;return"input"===r||s&&"replacement"===r})),v=null===(r=u[p.length+o.length-1])||void 0===r?void 0:r.index,d=null===(t=u[p.length-1])||void 0===t?void 0:t.index,h=null===(n=u[p.length+o.length])||void 0===n?void 0:n.index;if("insert"===a){if(void 0!==v)return v+1;if(void 0!==h)return h;if(void 0!==d)return d+1}if("deleteForward"===a){if(void 0!==h)return h;if(void 0!==d)return d+1}if("deleteBackward"===a){if(void 0!==d)return d+1;if(void 0!==h)return h}var f=l.split("").findIndex((function(e){return Object.prototype.hasOwnProperty.call(i,e)}));return-1!==f?f:l.length}({inputType:t,value:z.value,addedValue:a,beforeChangeValue:v,parts:z.parts,replacement:I,separate:S});return j.current.value=z.value,j.current.props={mask:P,replacement:I,showMask:T,separate:S},{value:z.value,selectionStart:_,selectionEnd:_,__detail:z}}),[d,x,k,y,w]),P=a({init:V,tracking:E,customInputEventType:"input-mask",customInputEventHandler:b});return function(r){var t=r.inputRef,n=r.mask,a=r.replacement;e((function(){var e,r,o;if("production"!==process.env.NODE_ENV){var p=null!==(o=null===(r=null===(e=t.current)||void 0===e?void 0:e._wrapperState)||void 0===r?void 0:r.initialValue)&&void 0!==o?o:"";p.length>n.length&&console.error(l("The initialized value of the `value` or `defaultValue` property is longer than the value specified in the `mask` property. Check the correctness of the initialized value in the specified property.",'Invalid value: "'.concat(p,'".')));var c=Object.keys(a).filter((function(e){return e.length>1}));c.length>0&&console.error(l("Object keys in the `replacement` property are longer than one character. Replacement keys must be one character long. Check the correctness of the value in the specified property.","Invalid keys: ".concat(c.join(", "),".")));var i=n.slice(0,p.length).split("").findIndex((function(e,r){var t=Object.prototype.hasOwnProperty.call(a,e),n=e!==p[r];return t?!!n&&!a[e].test(p[r]):n}));-1!==i&&console.error(l("An invalid character was found in the initialized property value `value` or `defaultValue` (index: ".concat(i,"). Check the correctness of the initialized value in the specified property."),'Invalid value: "'.concat(p,'".')))}}),[])}({inputRef:P,mask:d,replacement:O}),P}export{u as default};
