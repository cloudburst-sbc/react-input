"use strict";var e=require("react"),t=require("../errors/SyntheticChangeError.cjs"),n=require("../utils/setInputAttributes.cjs"),r=require("./useDispatchCustomInputEvent.cjs");require("react-dom");var u=function(e){return null!==e&&"text"===e.type};module.exports=function(l){var i=l.init,c=l.tracking,a=l.customInputEventType,o=l.customInputEventHandler,s=e.useRef(null),d=e.useRef({requestID:-1,fallbackRequestID:-1,cachedRequestID:-1,start:0,end:0}),v=r(s,a,o),f=v[0],h=v[1];return e.useEffect((function(){"production"!==process.env.NODE_ENV&&(null===s.current&&console.warn("Warn: Input element does not exist."),null!==s.current&&"text"!==s.current.type&&console.warn('Warn: The type of the input element does not match the type "text".'))}),[]),e.useEffect((function(){var e;if(null!==s.current&&u(s.current)){var t=null!==(e=s.current._wrapperState)&&void 0!==e?e:{},r=t.controlled,l=void 0!==r&&r,c=t.initialValue,a=void 0===c?"":c,o=i({controlled:l,initialValue:s.current.value||a});n(s.current,{value:o.value})}}),[]),e.useEffect((function(){var e=function(e){var r,l,i,a,o,v,f,p,E,m,q,w,I,_,b,D;if(u(s.current))try{if(null===s.current)throw new t("Reference to input element is not initialized.");if(d.current.cachedRequestID===d.current.requestID)throw new t("The input selection has not been updated.");d.current.cachedRequestID=d.current.requestID;var g=s.current,S=g.value,k=g.selectionStart,y=g.selectionEnd;if(null===k||null===y)throw new t("The selection attributes have not been initialized.");var R=null!==(i=null===(l=null===(r=s.current._valueTracker)||void 0===r?void 0:r.getValue)||void 0===l?void 0:l.call(r))&&void 0!==i?i:"",T="initial";if(k>d.current.start?T="insert":k<=d.current.start&&k<d.current.end?T="deleteBackward":k===d.current.end&&S.length<R.length&&(T="deleteForward"),("deleteBackward"===T||"deleteForward"===T)&&S.length>R.length)throw new t("Input type detection error.");var V="",F="",A=d.current.start,L=d.current.end;switch(T){case"insert":V=S.slice(d.current.start,k);break;case"deleteBackward":case"deleteForward":var x=R.length-S.length;A=k,L=k+x,F=R.slice(A,L);break;default:throw new t("The input type is undefined.")}var j=c({inputType:T,value:S,addedValue:V,deletedValue:F,previousValue:R,changeStart:A,changeEnd:L,selectionStart:k,selectionEnd:y});n(s.current,{value:j.value,selectionStart:j.selectionStart,selectionEnd:j.selectionEnd}),h(j.__detail),null===(o=null===(a=s.current._valueTracker)||void 0===a?void 0:a.setValue)||void 0===o||o.call(a,R),d.current.start=j.selectionStart,d.current.end=j.selectionEnd}catch(t){var B=t,C=B.name,z=B.cause;if(null!==s.current&&n(s.current,{value:null!==(m=null!==(f=null===(v=null==z?void 0:z.__attributes)||void 0===v?void 0:v.value)&&void 0!==f?f:null===(E=null===(p=s.current._valueTracker)||void 0===p?void 0:p.getValue)||void 0===E?void 0:E.call(p))&&void 0!==m?m:"",selectionStart:null!==(w=null===(q=null==z?void 0:z.__attributes)||void 0===q?void 0:q.selectionStart)&&void 0!==w?w:d.current.start,selectionEnd:null!==(_=null===(I=null==z?void 0:z.__attributes)||void 0===I?void 0:I.selectionEnd)&&void 0!==_?_:d.current.end}),void 0!==(null===(b=null==z?void 0:z.__attributes)||void 0===b?void 0:b.selectionStart)&&(d.current.start=z.__attributes.selectionStart),void 0!==(null===(D=null==z?void 0:z.__attributes)||void 0===D?void 0:D.selectionEnd)&&(d.current.end=z.__attributes.selectionEnd),e.preventDefault(),e.stopPropagation(),"SyntheticChangeError"!==C)throw t}},r=s.current;return null==r||r.addEventListener("input",e),function(){null==r||r.removeEventListener("input",e)}}),[c,h]),e.useEffect((function(){var e=function(){if(u(s.current)){var e=function(){var t,n,r,u;f.current?(d.current.start=null!==(n=null===(t=s.current)||void 0===t?void 0:t.selectionStart)&&void 0!==n?n:0,d.current.end=null!==(u=null===(r=s.current)||void 0===r?void 0:r.selectionEnd)&&void 0!==u?u:0,d.current.requestID=requestAnimationFrame(e)):d.current.fallbackRequestID=requestAnimationFrame(e)};d.current.requestID=requestAnimationFrame(e)}};null!==s.current&&document.activeElement===s.current&&e();var t=s.current;return null==t||t.addEventListener("focus",e),function(){null==t||t.removeEventListener("focus",e)}}),[]),e.useEffect((function(){var e=function(){u(s.current)&&(cancelAnimationFrame(d.current.requestID),cancelAnimationFrame(d.current.fallbackRequestID),d.current.requestID=-1,d.current.fallbackRequestID=-1,d.current.cachedRequestID=-1)},t=s.current;return null==t||t.addEventListener("blur",e),function(){null==t||t.removeEventListener("blur",e)}}),[]),s};
